openapi: 3.0.0
info:
  version: 0.9.0
  title: Policendaten Schadenmeldung API
  description: |
    ğŸ‡©ğŸ‡ª Diese API liefert Policendaten basierend auf dem Ereignis-Datum fÃ¼r eine Schadenmeldung.

    ğŸ‡¬ğŸ‡§ This API provides policy data based on the event date for an accident report.
  license:
    name: Apache License 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
servers:
  - url: FIXME

paths:
  /policy:
    get:
      description: |
        ğŸ‡©ğŸ‡ª Liefert eine Liste von Subnummern basierend auf dem Ereignis-Datum und optional der Suva KundenNr. 
        Falls keine KundenNr angegeben wird, wird die Authentifizierung zur Identifikation des Kunden verwendet.

        ğŸ‡¬ğŸ‡§ Provides a list of subnumbers based on the event date and optionally the Suva customer ID. 
        If no customer ID is specified, authentication will identify the customer.
      tags:
        - Policendaten
      operationId: getPolicy
      parameters:
        - name: eventDate
          in: query
          required: true
          description: |
            ğŸ‡©ğŸ‡ª Das Datum des Unfall-Ereignisses. Wenn das aktuelle Tagesdatum verwendet wird, muss die Schnittstelle
            spÃ¤ter erneut mit dem Ereignis-Datum des Schadens aufgerufen werden, insbesondere bei einem Jahreswechsel,
            um sicherzustellen, dass die in der Schadenmeldung referenzierten Objekte zum Ereignis-Datum gÃ¼ltig sind.
            **EinschrÃ¤nkung:** Datum muss <= Tagesdatum sein und nicht weiter zurÃ¼ck als das vorhergehende Kalenderjahr.

            ğŸ‡¬ğŸ‡§ The event date. If the current date is used, the API should later be called again
            with the accident event date, particularly if a year change occurs in between,
            to ensure objects referenced in the accident report are valid at the event date.
            **Restriction:** The date must be <= today's date and no earlier than the previous calendar year.
          schema:
            type: string
            format: date
        - name: customerID
          in: query
          required: false
          description: |
            ğŸ‡©ğŸ‡ª Die Suva-Kundennummer (z.B. 8-01747-90000).

            ğŸ‡¬ğŸ‡§ Suva customer ID (e.g., 8-01747-90000).
          schema:
            type: string
        - $ref: "#/components/parameters/X-Client-Vendor"
        - $ref: "#/components/parameters/X-Client-Name"
        - $ref: "#/components/parameters/X-Client-Version"
      security:
        # ğŸ‡©ğŸ‡ª entweder mit API-Key oder anonym - im Fall von anonymem Zugriff werden nicht alle Daten geliefert.
        #       
        # ğŸ‡¬ğŸ‡§ Access can be anonymous, but API-key usage is recommended as anonymous access may limit data retrieval.
        #
        - [] # anonymous
        - ApiKeyAuth: [] 
      responses:
        200:
          description: |
            ğŸ‡©ğŸ‡ª Liste von Subnummern der Police.

            ğŸ‡¬ğŸ‡§ List of policy subnumbers.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Subnummer"
        401:
          description: |
            ğŸ‡©ğŸ‡ª UngÃ¼ltige Authentifizierung oder Daten mit der Authentifizierung nicht zugÃ¤nglich.

            ğŸ‡¬ğŸ‡§ Invalid authentication or inaccessible data for the provided authentication.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        400:
          description: |
            ğŸ‡©ğŸ‡ª Anfrage konnte nicht verarbeitet werden.

            ğŸ‡¬ğŸ‡§ The request could not be processed due to an error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /policy/{language}/{gender}:
    get:
      description: |
        ğŸ‡©ğŸ‡ª Liefert eine gefilterte Liste von Subnummern basierend auf Sprache und Geschlecht.

        ğŸ‡¬ğŸ‡§ Provides a filtered list of subnumbers based on language and gender.
      tags:
        - Policendaten
      operationId: getPolicyFiltered
      parameters:
        - name: language
          in: path
          required: true
          schema:
            type: string
            enum: [de, fr, it, en]
          description: |
            ğŸ‡©ğŸ‡ª GewÃ¼nschte Sprache fÃ¼r die Berufsbezeichnungen.

            ğŸ‡¬ğŸ‡§ Desired language for occupation descriptions.
        - name: gender
          in: path
          required: true
          schema:
            $ref: "#/components/schemas/Gender"
          description: |
            ğŸ‡©ğŸ‡ª GewÃ¼nschtes Geschlecht fÃ¼r die Berufsbezeichnungen.

            ğŸ‡¬ğŸ‡§ Desired gender for occupation descriptions.
        - name: eventDate
          in: query
          required: true
          description: |
            ğŸ‡©ğŸ‡ª Das Datum des Unfall-Ereignisses. Wenn das aktuelle Tagesdatum verwendet wird, muss die Schnittstelle
            spÃ¤ter erneut mit dem Ereignis-Datum des Schadens aufgerufen werden, insbesondere bei einem Jahreswechsel,
            um sicherzustellen, dass die in der Schadenmeldung referenzierten Objekte zum Ereignis-Datum gÃ¼ltig sind.
            **EinschrÃ¤nkung:** Datum muss <= Tagesdatum sein und nicht weiter zurÃ¼ck als das vorhergehende Kalenderjahr.

            ğŸ‡¬ğŸ‡§ The event date. If the current date is used, the API should later be called again
            with the accident event date, particularly if a year change occurs in between,
            to ensure objects referenced in the accident report are valid at the event date.
            **Restriction:** The date must be <= today's date and no earlier than the previous calendar year.
          schema:
            type: string
            format: date
        - name: customerID
          in: query
          required: false
          description: |
            ğŸ‡©ğŸ‡ª Die Suva-Kundennummer (z.B. 8-01747-90000).

            ğŸ‡¬ğŸ‡§ Suva customer ID (e.g., 8-01747-90000).
          schema:
            type: string
        - $ref: "#/components/parameters/X-Client-Vendor"
        - $ref: "#/components/parameters/X-Client-Name"
        - $ref: "#/components/parameters/X-Client-Version"
      responses:
        200:
          description: |
            ğŸ‡©ğŸ‡ª Gefilterte Liste von Subnummern.

            ğŸ‡¬ğŸ‡§ Filtered list of subnumbers.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SubnummerFiltered"
        400:
          $ref: "#/components/responses/NotAuthenticatedError"

components:
  securitySchemes:
    ApiKeyAuth:
      description: |
        ğŸ‡©ğŸ‡ª Authentifizierung Ã¼ber Bearer-Token - siehe OAuth-Beispiele auf https://github.com/suva-ch/risk-api-demo-python/tree/main

        ğŸ‡¬ğŸ‡§ Authentication via Bearer Token - see OAuth examples at https://github.com/suva-ch/risk-api-demo-python/tree/main
      type: http
      scheme: bearer

  parameters:
    X-Client-Vendor:
      name: X-Client-Vendor
      in: header
      description: |
        ğŸ‡©ğŸ‡ª Name des Herstellers der Client-Anwendung.

        ğŸ‡¬ğŸ‡§ Name of the vendor responsible for the client application.
      required: false
      schema:
        type: string
      example: "Acme Corporation"
    X-Client-Name:
      name: X-Client-Name
      in: header
      description: |
        ğŸ‡©ğŸ‡ª Produkt-Name der Client-Anwendung.

        ğŸ‡¬ğŸ‡§ Product name of the client application.
      required: false
      schema:
        type: string
      example: "PayrollPro"
    X-Client-Version:
      name: X-Client-Version
      in: header
      description: |
        ğŸ‡©ğŸ‡ª Version der Anwendung.

        ğŸ‡¬ğŸ‡§ Version of the application.
      required: false
      schema:
        type: string
      example: "2.5"
      
  schemas:
    Subnummer:
      description: |
        ğŸ‡©ğŸ‡ª Datenstruktur einer Subnummer.

        ğŸ‡¬ğŸ‡§ Data structure of a subnumber.
      type: object
      properties:
        subnumberCode:
          type: string
          description: |
            ğŸ‡©ğŸ‡ª Subnummer als 2-stellige Zahl.

            ğŸ‡¬ğŸ‡§ Subnumber as a 2-digit code.
          example: "01"
          pattern: "^\\d{2}$"
        description:
          type: string
          description: |
            ğŸ‡©ğŸ‡ª Beschreibung der Subnummer in der Sprache des Kunden (keine Mehrsprachigkeit verfÃ¼gbar).
            Bei anonymem Zugriff werden diese Daten nicht geliefert.

            ğŸ‡¬ğŸ‡§ Description of the subnumber in the customer's language (multilingualism not available).
            This data is not available for anonymous access.
        premiumModel:
          type: string
          enum: [UVG_CLASSIC, UVG_OCCUPATION_CODES]
          description: |
            ğŸ‡©ğŸ‡ª Premien-Modell der Subnummer.
            UVG_CLASSIC: klassisch UVG mit Risiko-Ermittlung auf Basis von Betriebsbeschreibung
            UVG_OCCUPATION_CODES: UVG mit Risiko-Ermittlung auf Basis von Berufscodes

            ğŸ‡¬ğŸ‡§ Premium Model of subnumber.
            UVG_CLASSIC: classic UVG with risk identification based on description of operation
            UVG_OCCUPATION_CODES: UVG with risk identification based on occupation codes
        businessUnits:
          type: array
          description: |
            ğŸ‡©ğŸ‡ª EnthÃ¤lt Betriebsteile, wenn das PrÃ¤mienmodell `UVG_CLASSIC` ist.

            ğŸ‡¬ğŸ‡§ Contains business parts if the premium model is `UVG_CLASSIC`.
          items:
            $ref: "#/components/schemas/BusinessUnit"
        occupationCodes:
          type: array
          description: |
            ğŸ‡©ğŸ‡ª EnthÃ¤lt Berufscodes, wenn das PrÃ¤mienmodell `UVG_OCCUPATION_CODES` ist.

            ğŸ‡¬ğŸ‡§ Contains occupation codes if the premium model is `UVG_OCCUPATION_CODES`.
          items:
            $ref: "#/components/schemas/OccupationCode"
      required:
        - subnumberCode
        - premiumModel

    SubnummerFiltered:
      description: |
        ğŸ‡©ğŸ‡ª Gefilterte Datenstruktur einer Subnummer mit sprachspezifischen Beschreibungen.

        ğŸ‡¬ğŸ‡§ Filtered data structure of a subnumber with language-specific descriptions.
      type: object
      properties:
        subnumberCode:
          type: string
          description: |
            ğŸ‡©ğŸ‡ª Subnummer als 2-stellige Zahl.

            ğŸ‡¬ğŸ‡§ Subnumber as a 2-digit code.
          example: "01"
          pattern: "^\\d{2}$"
        description:
          type: string
        premiumModel:
          type: string
          enum: [UVG_CLASSIC, UVG_OCCUPATION_CODES]
        businessUnits:
          type: array
          items:
            $ref: "#/components/schemas/BusinessUnitFiltered"
        occupationCodes:
          type: array
          items:
            $ref: "#/components/schemas/OccupationCodeFiltered"
      required:
        - subnumberCode
        - premiumModel

    BusinessUnit:
      description: |
        ğŸ‡©ğŸ‡ª Ein Betriebsteil innerhalb einer Subnummer.

        ğŸ‡¬ğŸ‡§ A business part within a subnumber.
      type: object
      properties:
        businessUnitCode:
          type: string
          description: |
            ğŸ‡©ğŸ‡ª Buchstabe zur Identifikation des Betriebsteils.

            ğŸ‡¬ğŸ‡§ Letter identifier for the business part.
          example: "A"
          pattern: "^[A-Z]$"
        description:
          type: string
          description: |
            ğŸ‡©ğŸ‡ª Textbeschreibung des Betriebsteils in der Sprache des Kunden (keine Mehrsprachigkeit verfÃ¼gbar).
            Bei anonymem Zugriff werden diese Daten nicht geliefert.

            ğŸ‡¬ğŸ‡§ Text description of the business part in the customer's language (multilingualism not available).
            This data is not available for anonymous access.
      required:
        - businessUnitCode

    BusinessUnitFiltered:
      type: object
      properties:
        businessUnitCode:
          type: string
          example: "A"
          pattern: "^[A-Z]$"
        description:
          type: string
      required:
        - businessUnitCode

    OccupationCode:
      description: |
        ğŸ‡©ğŸ‡ª Details zu einem Berufscode.

        ğŸ‡¬ğŸ‡§ Details of an occupation code.
      type: object
      properties:
        occupationCodeNr1:
          type: string
          description: |
            ğŸ‡©ğŸ‡ª Berufscode-Nummer 1 - vom Kunden vergeben

            ğŸ‡¬ğŸ‡§ Occupation code number 1 - assigned by the customer.
        occupationCodeNr2:
          type: string
          description: |
            ğŸ‡©ğŸ‡ª Berufscode-Nummer 2 - vom Kunden vergeben

            ğŸ‡¬ğŸ‡§ Occupation code number 2 - assigned by the customer.
        suvaOccupationCodeId:
          type: string
          format: uuid
          description: |
            ğŸ‡©ğŸ‡ª Eindeutige ID des Suva-Berufscodes.

            ğŸ‡¬ğŸ‡§ Unique ID of the Suva occupation code.

        IscoOccupationTypeId:
          description: |
            ğŸ‡©ğŸ‡ª 5-Stellige Nummer fÃ¼r Berufsarten aus der Schweizer Berufsnomenklatur.
            z.B. "71140" fÃ¼r "Eisenleger"

            ğŸ‡¬ğŸ‡§ 5-digit code for occupations from the Swiss occupational nomenclature.
            e.G. "71140" for "Reinforcing iron and rebar worker"
          type: integer
          example: 71140

        active:
          type: boolean
          description: |
            ğŸ‡©ğŸ‡ª Gibt an, ob der Berufscode aktiv ist.

            ğŸ‡¬ğŸ‡§ Indicates if the occupation code is active.
        descriptions:
          type: array
          description: |
            ğŸ‡©ğŸ‡ª Sprach- und geschlechtsspezifische Berufsbezeichnung.

            ğŸ‡¬ğŸ‡§ Language- and gender-specific occupation description.
          items:
            $ref: "#/components/schemas/OccupationDescription"
        businessUnitCode:
          type: string
          description: |
            ğŸ‡©ğŸ‡ª Buchstabe des zugehÃ¶rigen Betriebsteils fÃ¼r Schadenmeldung

            ğŸ‡¬ğŸ‡§ Letter of the associated business part for accident reporting.
          example: "A"
          pattern: "^[A-Z]$"
      required:
        - suvaOccupationCodeId
        - IscoOccupationTypeId
        - active
        - businessUnitCode

    OccupationCodeFiltered:
      type: object
      properties:
        occupationCodeNr1:
          type: string
        occupationCodeNr2:
          type: string
        suvaOccupationCodeId:
          type: string
          format: uuid
        IscoOccupationTypeId:
          type: integer
        active:
          type: boolean
        description:
          type: string
        businessUnitCode:
          type: string
          example: "A"
          pattern: "^[A-Z]$"
      required:
        - suvaOccupationCodeId
        - IscoOccupationTypeId
        - active
        - businessUnitCode

    OccupationDescription:
      description: |
        ğŸ‡©ğŸ‡ª Sprach- und geschlechtsspezifische Berufsbezeichnung.

        ğŸ‡¬ğŸ‡§ Language- and gender-specific occupation description.
      type: object
      properties:
        language:
          type: string
          description: |
            ğŸ‡©ğŸ‡ª Sprache des Wertes.

            ğŸ‡¬ğŸ‡§ Language of the value.
          enum: [de, fr, it, en]

        gender:
              $ref: "#/components/schemas/Gender"

        value:
          type: string
          description: |
            ğŸ‡©ğŸ‡ª Text in der entsprechenden Sprache.

            ğŸ‡¬ğŸ‡§ Text in the corresponding language.
      required:
      - language
      - gender
      - value


    Gender:
      description: |
        ğŸ‡©ğŸ‡ª  Geschlecht
        
        ğŸ‡¬ğŸ‡§ Gender
      type: string
      enum: [ female, genderless, male ]


    Error:
      description: |
        ğŸ‡©ğŸ‡ª Fehlermeldung

        ğŸ‡¬ğŸ‡§ Error message.
      properties:
        message:
          description: |
            ğŸ‡©ğŸ‡ª Die in englischer Sprache gelieferte Fehlermeldung. Beispiel: 'Berufscode-Liste for Partner-Nr. '9999999999' not found'.

            ğŸ‡¬ğŸ‡§ Error message provided in English. Example: 'Occupation code list for partner number '9999999999' not found.'
          type: string
        id:
          description: |
            ğŸ‡©ğŸ‡ª Eindeutige ID der Fehlermeldung. Beispiel: Zwei Fehlermeldungen 'Berufscode-Liste for Partner-Nr. '9999999999' not found' haben unterschiedliche ID's.

            ğŸ‡¬ğŸ‡§ Unique ID of the error message. Example: Two error messages 'Occupation code list for partner number '9999999999' not found' have different IDs.
          type: string
        key:
          description: |
            ğŸ‡©ğŸ‡ª Key der Fehlermeldung. Beispiel: Zwei Fehlermeldungen 'Berufscode-Liste for Partner-Nr. '9999999999' not found' haben denselben Key.

            ğŸ‡¬ğŸ‡§ Key of the error message. Example: Two error messages 'Occupation code list for partner number '9999999999' not found' have the same key.
          type: string
        args:
          description: |
            ğŸ‡©ğŸ‡ª Argumente fÃ¼r die Aufbereitung einer Fehlermeldung. Zum Beispiel: '9999999999'

            ğŸ‡¬ğŸ‡§ Arguments for formatting an error message. For example: '9999999999'
          type: array
          items:
            type: string
      required:
        - message
        - id
        - key

  responses:
    NotAuthenticatedError:
      description: |
        ğŸ‡©ğŸ‡ª Keine gÃ¼ltigen Authentifizierungsdaten fÃ¼r die angeforderte Ressource vorhanden.

        ğŸ‡¬ğŸ‡§ No valid authentication data available for the requested resource.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"
