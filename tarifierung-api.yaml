openapi: 3.0.0
info:
  version: 0.1.0
  title: Tariff classification REST API
  x-audience: partner
  description: |
    **de**: Beschreibt die gegenüber einem ERP angebotenen Schnittstellen auf Seite Suva für die Pflege der Berufscodes.
    
    **en**: Describes the interfaces offered to an ERP system by Suva for maintaining occupational codes.
  license:
    name: Apache License 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
servers:
  - url: fixme

paths:
  /v1/suva-occupation-codes:
    parameters:
      - $ref: "#/components/parameters/X-Client-Vendor"
      - $ref: "#/components/parameters/X-Client-Name"
      - $ref: "#/components/parameters/X-Client-Version"

    get:
      description: |
        **de**: Liefert alle von der Suva bereitgestellten branchenüblichen Berufscodes mit der Zuordnung zu der ISCO-Berufsart.

        **en**: Provides all industry standard occupation codes provided by Suva, with the assignment to the ISCO type of profession.
      tags:
        - Suva Occupation Codes
      operationId: getSuvaOccupationCodes
      responses:
        200:
          description: |
            **de**: Liste von Suva-Berufscodes.
            
            **en**: List of Suva occupation codes.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SuvaOccupationCode"

  /v1/isco-occupation-types:
    parameters:
      - $ref: "#/components/parameters/X-Client-Vendor"
      - $ref: "#/components/parameters/X-Client-Name"
      - $ref: "#/components/parameters/X-Client-Version"

    get:
      description: |
        **de**: Liefert alle in der Suva unterstützen ISCO-Berufsarten.
        
        **en**: Provides all ISCO occupation types supported by the Suva.
      tags:
        - ISCO Occupation Types
      operationId: getIscoOccupationTypes
      parameters:
        - $ref: "#/components/parameters/PremiumYear"
      responses:
        400:
          $ref: "#/components/responses/BadRequestError"
        200:
          description: |
            **de**: Liste von ISCO-Berufsarten und zugeordnete Risiko-Klassen.
            
            **en**: List of ISCO occupation types and associated risk classes.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/IscoOccupationType"

  /v1/business-units:
    parameters:
      - $ref: "#/components/parameters/X-Client-Vendor"
      - $ref: "#/components/parameters/X-Client-Name"
      - $ref: "#/components/parameters/X-Client-Version"

    get:
      description: |
        **de**: Liefert die Betriebsteil-Situation für alle Betriebsteile (ggf. auch Betriebsteile die keine Personalverleih-Tätigkeiten durchführen).
        
        **en**: Provides the profiles for all operating units (possibly also operating units that do not carry out personnel leasing activities).
      tags:
        - Occupation Codes
      operationId: getOperatingUnitProfiles
      parameters:
        - $ref: "#/components/parameters/PremiumYear"
      responses:
        400:
          $ref: "#/components/responses/BadRequestError"
        200:
          description: |
            **de**: Liste von Betriebsteil-Situationen.
            
            **en**: List of operation unit profiles.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/OperatingUnitProfile"

  /v1/occupation-codes:
    parameters:
      - $ref: "#/components/parameters/X-Client-Vendor"
      - $ref: "#/components/parameters/X-Client-Name"
      - $ref: "#/components/parameters/X-Client-Version"

    get:
      description: |
        **de**: Liefert alle Berufscodes (Individuell und Suva) zu dem angemeldeten Personalverleiher.
        
        **en**: Provides all occupation codes (individual and Suva) for the registered personnel provider.
      tags:
        - Occupation Codes
      operationId: getOccupationCodes
      responses:
        401:
          $ref: "#/components/responses/NotAuthenticatedError"
        200:
          description: |
            **de**: Liste von Berufscodes.
            
            **en**: List of occupation codes.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/OccupationCode"

    put:
      description: |
        **de**: Einen Berufscode aus den Suva-Berufscodes hinzufügen.
        
        **en**: Add a occupation code from the Suva occupation codes.
      tags:
        - Occupation Codes
      operationId: activateOccupationCode
      requestBody:
        description: |
          **de**: Der hinzuzufügende Suva-Berufscode.
          
          **en**: The Suva occupation code to be added.
        required: true
        content:
          application/json:
            schema:
              title: OccupationCodeActivation
              type: object
              properties:
                suvaOccupationCodeId:
                  $ref: "#/components/schemas/SuvaOccupationCodeId"
                occupationCodeNr1:
                  $ref: "#/components/schemas/OccupationCodeNr"
                occupationCodeNr2:
                  $ref: "#/components/schemas/OccupationCodeNr"
              required:
                - suvaOccupationCodeId
      responses:
        400:
          $ref: "#/components/responses/BadRequestError"
        401:
          $ref: "#/components/responses/NotAuthenticatedError"
        404:
          $ref: "#/components/responses/NotFoundError"
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OccupationCode"

    post:
      description: |
        **de**: Einen individuellen Berufscode einreichen.
        
        **en**: Submit an individual occupation code.
      tags:
        - Occupation Codes
      operationId: submitOccupationCode
      requestBody:
        description: |
          **de**: Der individuelle Berufscode inklusive führender Sprache.
          
          **en**: The individual occupation code including leading language.
        required: true
        content:
          application/json:
            schema:
              title: SubmitOccupationCode
              type: object
              properties:
                occupationCodeNr1:
                  $ref: "#/components/schemas/OccupationCodeNr"
                occupationCodeNr2:
                  $ref: "#/components/schemas/OccupationCodeNr"
                preferredLanguage:
                  $ref: "#/components/schemas/Language"
                descriptions:
                  type: array
                  minItems: 1
                  items:
                    $ref: "#/components/schemas/OccupationDescription"
              required:
                - preferredLanguage
                - descriptions
      responses:
        400:
          $ref: "#/components/responses/BadRequestError"
        401:
          $ref: "#/components/responses/NotAuthenticatedError"
        200:
          description: Success
          content:
            application/json:
              schema:
                title: OccupationCodeSubmitted
                type: object
                properties:
                  occupationCodeId:
                    $ref: "#/components/schemas/OccupationCodeId"
                  eventId:
                    $ref: "#/components/schemas/EventId"
                required:
                  - occupationCodeId
                  - eventId

  /v1/occupation-codes/{occupationCodeId}:
    parameters:
      - $ref: "#/components/parameters/OccupationCodeId"
      - $ref: "#/components/parameters/X-Client-Vendor"
      - $ref: "#/components/parameters/X-Client-Name"
      - $ref: "#/components/parameters/X-Client-Version"

    delete:
      description: |
        **de**: Der Berufscode wird bei Suva auf das aktuelle Datum deaktiviert. Eine Aktivierung ist danach nicht mehr möglich.
        
        **en**: The occupation code will be deactivated at Suva on the current date. Activation is not possible afterwards.
      tags:
        - Occupation Codes
      operationId: deactivateOccupationCode
      responses:
        401:
          $ref: "#/components/responses/NotAuthenticatedError"
        404:
          $ref: "#/components/responses/NotFoundError"
        204:
          description: Berufscode deaktiviert.

  /v1/events:
    parameters:
      - $ref: "#/components/parameters/X-Client-Vendor"
      - $ref: "#/components/parameters/X-Client-Name"
      - $ref: "#/components/parameters/X-Client-Version"

    get:
      description: >-
        **de**: Abfrage aller nicht quittierten Events.
        
        **en**: Query of all unacknowledged events.
      tags:
        - Events
      operationId: getEvents
      security:
        - ApiKeyAuth: [ ]
      responses:
        401:
          $ref: "#/components/responses/NotAuthenticatedError"
        200:
          description: |
            **de**: Liste von Events.
            
            **en**: List of events.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Event"

  /v1/events/{eventId}:
    parameters:
      - $ref: "#/components/parameters/EventId"
      - $ref: "#/components/parameters/X-Client-Vendor"
      - $ref: "#/components/parameters/X-Client-Name"
      - $ref: "#/components/parameters/X-Client-Version"

    get:
      description: |
        **de**: Abfrage eines spezifischen Events.
        
        **en**: Query of a specific event.
      tags:
        - Events
      operationId: getEvent
      security:
        - ApiKeyAuth: [ ]
      responses:
        401:
          $ref: "#/components/responses/NotAuthenticatedError"
        404:
          $ref: "#/components/responses/NotFoundError"
        200:
          description: Der angefragte Event.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Event"

    delete:
      description: |
        **de**: Wird ein offener Event quittiert, wird dieser nicht mehr in [/v1/events](#/Event/getEvents) aufgeführt.
        
        **en**: Once an open event is acknowledged, it will no longer be listed in [/v1/events](#/Event/getEvents).
      tags:
        - Events
      operationId: acknowledgeEvent
      security:
        - ApiKeyAuth: [ ]
      responses:
        401:
          $ref: "#/components/responses/NotAuthenticatedError"
        404:
          $ref: "#/components/responses/NotFoundError"
        422:
          $ref: "#/components/responses/UnprocessableContentError"
        204:
          description: |
            **de**: Der Event ist quittiert.
            
            **en**: The event is acknowledged.

components:
  parameters:
    PremiumYear:
      name: year
      description: |
        **de**: Prämienjahr, muss zwischen 2024 und dem aktuellen Kalenderjahr liegen (Default: Kalenderjahr)
        
        **en**: Premium year, must be between 2024 and the current calendar year (default: calendar year).
      in: query
      schema:
        $ref: "#/components/schemas/PremiumYear"

    OccupationCodeId:
      name: occupationCodeId
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/OccupationCodeId"

    EventId:
      name: eventId
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/EventId"

    # headers
    X-Client-Vendor:
      name: X-Client-Vendor
      in: header
      description: |
        **de**: Name des Herstellers der Client-Anwendung.

        **en**: Name of the vendor responsible for the client application.
      required: false
      schema:
        type: string
      example: "Acme Corporation"

    X-Client-Name:
      name: X-Client-Name
      in: header
      description: |
        **de**: Produkt-Name der Client-Anwendung.

        **en**: Product name of the client application.
      required: false
      schema:
        type: string
      example: "PayrollPro"

    X-Client-Version:
      name: X-Client-Version
      in: header
      description: |
        **de**: Version der Anwendung.

        **en**: Version of the application.
      required: false
      schema:
        type: string
      example: "2.5"

  responses:
    BadRequestError:
      description: |
        **de**: Anfrage kann nicht verarbeitet werden.
        
        **en**: Request cannot be processed.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    NotAuthenticatedError:
      description: |
        **de**: Keine gültigen Authentifizierungsdaten für die angeforderte Ressource vorhanden.
        
        **en**: No valid authentication data available for the requested resource.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    NotFoundError:
      description: |
        **de**: Die angeforderte Resource konnte nicht gefunden werden.
        
        **en**: The requested resource could not be found.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

    UnprocessableContentError:
      description: |
        **de**: Die Anfrage konnte nicht verarbeiten werden, da sie ungültige Daten enthält.
        
        **en**: The request could not be processed because it contains invalid data.
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Error"

  schemas:
    # suva occuption code

    SuvaOccupationCode:
      description: |
        **de**: Suva-Berufscode
        
        **en**: Suva occupation code
      type: object
      properties:
        id:
          $ref: "#/components/schemas/SuvaOccupationCodeId"
        descriptions:
          type: array
          minItems: 1
          items:
            $ref: "#/components/schemas/OccupationDescription"
        iscoOccupationTypeId:
          $ref: "#/components/schemas/IscoOccupationTypeId"
      required:
        - id
        - descriptions
        - iscoOccupationTypeId
    
    SuvaOccupationCodeId:
      description: |
        **de**: ID für einen Suva-Berufscode.
        
        **en**: ID for a Suva occupation code.
      type: string

    # isco occupation type

    IscoOccupationType:
      description: |
        **de**: ISCO-Berufsart
        
        **en**: ISCO occupation type
      type: object
      properties:
        id:
          $ref: "#/components/schemas/IscoOccupationTypeId"
        businessUnitCode:
          $ref: "#/components/schemas/BusinessUnitCode"
        subclassSection:
          $ref: "#/components/schemas/SubclassSection"
      required:
        - id
        - businessUnitCode
        - subclassSection
    
    IscoOccupationTypeId:
      description: |
        **de**: 5-Stellige Nummer für Berufsarten aus der Schweizer Berufsnomenklatur.
        
        **en**: 5-digit number for occupation type from the Swiss professional nomenclature.
      type: integer

    # occupation code

    OccupationCode:
      description: |
        **de**: Berufscode (Individuell oder Suva)
        
        **en**: Occupation code (individual or Suva)
      type: object
      properties:
        id:
          $ref: "#/components/schemas/OccupationCodeId"
        occupationCodeNr1:
          $ref: "#/components/schemas/OccupationCodeNr"
        occupationCodeNr2:
          $ref: "#/components/schemas/OccupationCodeNr"
        descriptions:
          type: array
          minItems: 1
          items:
            $ref: "#/components/schemas/OccupationDescription"
        suvaOccupationCode:
          $ref: "#/components/schemas/SuvaOccupationCode"
        active:
          $ref: "#/components/schemas/OccupationCodeActive"
      required:
        - id

    OccupationCodeId:
      description: |
        **de**: ID für ein Berfuscode.
        
        **en**: ID of a occupation code.
      type: string
      format: uuid

    # operating unit

    OperatingUnitProfile:
      description: |
        **de**: Betriebsteil-Situation
        
        **en**: Profiles for an operating unit
      type: object
      properties:
        businessUnitCode:
          $ref: "#/components/schemas/BusinessUnitCode"
        temporalProfiles:
          type: array
          items:
            $ref: "#/components/schemas/OperatingUnitTemporalProfile"
      required:
        - businessUnitCode
    
    BusinessUnitCode:
      description: |
        **de**: Betriebsteil-Code (BT-Code)
        
        **en**: Operating unit code
      type: string
      minLength: 1
      maxLength: 1
    
    OperatingUnitTemporalProfile:
      type: object
      properties:
        from:
          type: string
          format: date
        upto:
          type: string
          format: date
        subclassSection:
          $ref: "#/components/schemas/SubclassSection"
        descriptions:
          description: |
            **de**: Betriebsteil-Bezeichnungen.
            
            **en**: Operating unit description.
          type: array
          minItems: 1
          items:
            $ref: "#/components/schemas/LocalizedValue"
        premiums:
          $ref: "#/components/schemas/GrossPremium"
        iscoOccupationTypeIds:
          description: |
            **de**: Liste von ISCO-Berufsarten.
            
            **en**: List of ISCO occupation types.
          type: array
          items:
            $ref: "#/components/schemas/IscoOccupationTypeId"
      required:
        - from
        - upto
        - subclassSection
        - descriptions
        - iscoOccupationTypeIds

    # events

    Event:
      description: |
        **de**: Ein Event
        
        **en**: An event
      type: object
      properties:
        id:
          $ref: "#/components/schemas/EventId"
        timestamp:
          description: |
            **de**: Ereigniszeitpunkt
            
            **en**: Event occurrence time
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/EventStatus'
        detail:
          oneOf:
            - $ref: "#/components/schemas/EventOccupationCodeSubmitted"
            - $ref: "#/components/schemas/EventIscoOccupationTypeChanged"
            - $ref: "#/components/schemas/EventGrossPremiumChanged"
          discriminator:
            propertyName: eventType

    EventId:
      description: |
        **de**: ID für einen Event.
        
        **en**: ID of an event.
      type: string
      format: uuid

    EventStatus:
      description: |
        **de**: Status des Event.
        
        **en**: Status of an event.
      type: string
      enum: [ CREATED, PROCESSED, ACKNOWLEDGED ]

    EventOccupationCodeSubmitted:
      description: |
        **de**: Ergebnis zu "Einreichen eines Berufscodes".
        
        **en**: Result for "Submitting an occupation code".
      type: object
      properties:
        eventType:
          type: string
        occupation:
          $ref: "#/components/schemas/OccupationCode"
      required:
        - eventType
    
    EventIscoOccupationTypeChanged:
      description: |
        **de**: Ein für den Kunden aktiver ISCO-Berufsart wurde von der Suva einem neuen Risiko (UKT) zugeordnet. Tätigkeiten mit dem geänderten Risiko erhalten potentiell anderen Prämiensätze.
        
        **en**: An ISCO occupation type active for the customer has been assigned a new risk (UKT) by the Suva. Activities with the changed risk may potentially receive different premium rates.
      type: object
      properties:
        eventType:
          type: string
        premiumYear:
          $ref: "#/components/schemas/PremiumYear"
        iscoOccupationType:
          $ref: "#/components/schemas/IscoOccupationType"
      required:
        - eventType
    
    EventGrossPremiumChanged:
      description: |
        **de**: Von der Suva wurden für einen Betriebsteil neue Prämiensätze verfügt.
        
        **en**: Suva has ordered new premium rates for an operation unit.
      type: object
      properties:
        eventType:
          type: string
        premiumYear:
          $ref: "#/components/schemas/PremiumYear"
        businessUnitCode:
          $ref: "#/components/schemas/BusinessUnitCode"
      required:
        - eventType

    # commons

    OccupationDescription:
      description: |
        **de**: Sprach- und geschlechtsspezifische Berufsbezeichnung.
        
        **en**: Language- and gender-specific occupation description.
      allOf:
        - $ref: "#/components/schemas/LocalizedValue"
        - type: object
          properties:
            gender:
              $ref: "#/components/schemas/Gender"
      required:
        - language
        - gender
        - value

    GrossPremium:
      description: |
        **de**: Bruttoprämiensätze (BPS)
        
        **en**: Gross premium rates (BPS)
      type: object
      properties:
        occupationalAccidentInsurance:
          description: |
            **de**: Berufsunfallversicherung (BUV)
            
            **en**: Occupational accident insurance (BUV)
          type: number
          format: float
        nonOccupationalAccidentInsurance:
          description: |
            **de**: Nichtberufsunfallversicherung (NBUV)
            
            **en**: Non occupational accident insurance (NBUV)
          type: number
          format: float
      required:
        - occupationalAccidentInsurance
        - nonOccupationalAccidentInsurance

    LocalizedValue:
      description: |
        **de**: Ein sprachbezogener Wert.
        
        **en**: A language-specific value.
      type: object
      properties:
        language:
          $ref: "#/components/schemas/Language"
        value:
          type: string
      required:
        - language
        - value

    OccupationCodeActive:
      description: |
        **de**: Gibt an, ob ein Berufscode aktiv ist oder nicht.

        **en**: Indicates whether an occupation code is active or not.
      type: boolean

    SubclassSection:
      description: |
        **de**: Unterklassenteil (UKT)
        
        **en**: Subclass section (UKT)
      type: string

    PremiumYear:
      description: |
        **de**: Prämienjahr (Standard: Kalenderjahr)
        
        **en**: Premium year (default: calendar year)
      type: integer
      minimum: 2000
      maximum: 3000

    Gender:
      description: |
        **de**: Geschlecht
        
        **en**: Gender
      type: string
      enum: [ female, genderless, male ]

    Language:
      description: |
        **de**: Sprache
        
        **en**: Language
      type: string
      enum: [ de, fr, it, en ]

    OccupationCodeNr:
      description: |
        **de**: Individueller Schlüssel zur Kennzeichnung des Berufscodes.
        
        **en**: Individual key for identifying the occupation code.
      maxLength: 40
      type: string

    Error:
      description: |
        **de**: Fehlermeldung
        
        **en**: Error message
      properties:
        message:
          description: |
            **de**: Die in englischer Sprache gelieferte Fehlermeldung. Beispiel: 'Berufscode-Liste for Partner-Nr. '9999999999' not found'.
            
            **en**: Error message provided in English. Example: 'Occupation code list for partner number '9999999999' not found.
          type: string
        id:
          description: |
            **de**: Eindeutige ID der Fehlermeldung. Beispiel: Zwei Fehlermeldungen 'Berufscode-Liste for Partner-Nr. '9999999999' not found' haben unterschiedliche ID's.
            
            **en**: Unique ID of the error message. Example: Two error messages 'Occupation code list for partner number '9999999999' not found' have different IDs.
          type: string
        key:
          description: |
            **de**: Key der Fehlermeldung. Beispiel: Zwei Fehlermeldungen 'Berufscode-Liste for Partner-Nr. '9999999999' not found' haben denselben Key.
            
            **en**: Key of the error message. Example: Two error messages 'Occupation code list for partner number '9999999999' not found' have the same key.
          type: string
        args:
          description: |
            **de**: Argumente für die Aufbereitung einer Fehlermeldung. Zum Beispiel: '9999999999'
            
            **en**: Arguments for formatting an error message. For example: '9999999999'
          type: array
          items:
            type: string
      required:
        - message
        - id
        - key

  securitySchemes:
    ApiKeyAuth:
      description: fixme
      type: apiKey
      in: header
      name: X-suva-api-key
